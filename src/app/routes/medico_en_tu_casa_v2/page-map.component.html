<div class="row">
  <button mat-fab class="classbutton">
    <mat-icon class="indicador" matSuffix>pin drop</mat-icon>
  </button>
  <div>
    <strong>&nbsp;&nbsp;Medico en tu casa V2 </strong>
    <p>&nbsp;&nbsp;Mapa de rutas del doctor</p>
  </div>
</div>

<mat-card class="global-card">
  <mat-card-header>
    <mat-card-title>
      <strong>TITULO (MAPA)</strong>
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <div class="custom-container">
      <div class="custom-div first-div">
        <div class="map-wrapper" [class.collapsed]="!sidebarVisible">
          <!-- Sidebar -->
          <aside class="sidebar">
            <div class="sidebar-header">
              <span class="logo">MÉDICO EN TU CASA</span>
              <label class="toggle">
                <input
                  type="checkbox"
                  [checked]="sidebarVisible"
                  (change)="toggleSidebar($event)"
                />
                <span class="slider"></span>
              </label>
            </div>

            <!-- Panel de detalles de ubicación -->
            <div *ngIf="sidebarVisible && showLocationDetails" class="location-details">
              <button mat-icon-button class="close-button" (click)="closeLocationDetails()">
                <mat-icon>close</mat-icon>
              </button>

              <div *ngIf="selectedLocation">
                <h3>{{ selectedLocation.formAmdNombrePaciente || 'Paciente' }}</h3>

                <div class="detail-row">
                  <mat-icon>location_on</mat-icon>
                  <div>
                    <strong>Dirección:</strong>
                    {{ selectedLocation.formAmdDireccion }}
                  </div>
                </div>

                <div class="detail-row">
                  <mat-icon>info</mat-icon>
                  <div>
                    <strong>Motivo:</strong>
                    {{ selectedLocation.formAmdMotivoConsulta }}
                  </div>
                </div>

                <div class="detail-row">
                  <mat-icon>description</mat-icon>
                  <div>
                    <strong>Referencia:</strong>
                    {{ selectedLocation.formAmdNumReferencia || 'N/A' }}
                  </div>
                </div>

                <div class="detail-row">
                  <mat-icon>add_location</mat-icon>
                  <div>
                    <strong>Ref. adicional:</strong>
                    {{ selectedLocation.formAmdRefAdicional || 'N/A' }}
                  </div>
                </div>

                <div class="detail-row">
                  <mat-icon>attach_money</mat-icon>
                  <div>
                    <strong>Importe:</strong>
                    {{ selectedLocation.formAmdImporte | currency }}
                  </div>
                </div>

                <div class="detail-row">
                  <mat-icon>payment</mat-icon>
                  <div>
                    <strong>Método pago:</strong>
                    {{ selectedLocation.formAmdMetodoPago || 'N/A' }}
                  </div>
                </div>

                <div class="detail-row">
                  <mat-icon>person</mat-icon>
                  <div>
                    <strong>Tipo ciudadano:</strong>
                    {{ selectedLocation.formAmdTipoCiudadano || 'N/A' }}
                  </div>
                </div>

                <div class="detail-row">
                  <mat-icon>badge</mat-icon>
                  <div>
                    <strong>ID ciudadano:</strong>
                    {{ selectedLocation.formAmdIdCiudadano || 'N/A' }}
                  </div>
                </div>

                <div class="detail-row">
                  <mat-icon>email</mat-icon>
                  <div>
                    <strong>Email:</strong>
                    {{ selectedLocation.formAmdEmail || 'N/A' }}
                  </div>
                </div>

                <div class="detail-row">
                  <mat-icon>medical_services</mat-icon>
                  <div>
                    <strong>Médico asignado:</strong>
                    {{ selectedLocation.formAmdMedico || 'N/A' }}
                  </div>
                </div>

                <div class="detail-row advanced-monitoring">
                  <mat-icon>watch</mat-icon>
                  <div>
                    <strong>MONITOREO AVANZADO</strong>

                    <div *ngIf="!isDeviceAssigned">
                      <p>¿El paciente requiere monitoreo remoto?</p>
                      <button mat-raised-button color="primary" (click)="openAssignDeviceDialog()">
                        ASIGNAR DISPOSITIVO
                      </button>
                    </div>

                    <div *ngIf="isDeviceAssigned" class="assigned-device">
                      <div class="device-status">
                        <mat-icon class="success-icon">check_circle</mat-icon>
                        <span>Dispositivo asignado correctamente</span>
                      </div>

                      <div class="device-info">
                        <p>
                          Dispositivo seleccionado: <strong>ID {{ selectedDeviceId }}</strong>
                        </p>

                        <div class="device-actions">
                          <button mat-raised-button class="inspect-btn" (click)="inspectDevice()">
                            <mat-icon>visibility</mat-icon>
                            INSPECCIONAR
                          </button>

                          <!-- <button mat-raised-button color="warn" (click)="removeDevice()">
                            <mat-icon>phonelink_erase</mat-icon>
                            RETIRAR DISPOSITIVO
                          </button> -->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Menú principal (solo visible cuando no se muestra la ubicación) -->
            <ul class="sidebar-menu" *ngIf="sidebarVisible && !showLocationDetails">
              <li>Opcion 1</li>
              <li>Opcion 2</li>
              <li>Opcion 3</li>
              <li>Opcion 4</li>

              <hr />

              <li>Opcion 5</li>
              <li>Opcion 6</li>
              <li>Opcion 7</li>
              <li>Opcion 8</li>

              <hr />
              <li>Opcion 9</li>
              <li>Opcion 10</li>
              <li>Opcion 11</li>
              <li>Opcion 12</li>
            </ul>
          </aside>

          <div class="main-content">
            <!-- Contenedor del mapa - visible solo cuando NO se muestran detalles -->
            <div id="map-container" class="map-container" *ngIf="!showSmartwatchDetails"></div>

            <!-- Componente de detalles - visible solo cuando showSmartwatchDetails es true -->
            <app-smartwatch-details
              *ngIf="showSmartwatchDetails"
              [deviceData]="smartwatchData"
              (close)="closeSmartwatchView()"
              class="smartwatch-view"
            ></app-smartwatch-details>
          </div>
        </div>
      </div>
    </div>
  </mat-card-content>
</mat-card>
